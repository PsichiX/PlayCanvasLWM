!function(t){"use strict";var e=t.lwm={pc:t.pc},n={exports:e};e.HOOK_INTO_PLAYCANVAS=t.hasOwnProperty("LWM_HOOK_INTO_PLAYCANVAS")?t.LWM_HOOK_INTO_PLAYCANVAS:!0,function(t){t.using=function(t,e){var n;try{n=e(t)}finally{t.destroy()}return n},t.stringFromBytes=function(t){return String.fromCharCode.apply(null,t)},t.stringFromBuffer=function(t){var e,n,o,r=new Uint16Array(t),a="";for(e=0,n=r.length;n>e;e+=65535)o=65535,e+65535>n&&(o=n-e),a+=String.fromCharCode.apply(null,r.subarray(e,e+o));return a}}(n.exports),function(t){function e(){this.mesh=-1,this.node=-1}function n(){this.min=[],this.max=[]}function o(){this.aabb=new n,this.base=-1,this.count=-1,this.type="",this.vertices=-1,this.indices=[]}function r(){this.name="",this.position=[],this.rotation=[],this.scale=[]}function a(){this.type="",this.components=-1,this.data=[]}function i(){this.position=new a,this.texCoord0=new a,this.normal=new a}function s(){this.version=-1,this.meshInstances=[],this.meshes=[],this.nodes=[],this.parents=[],this.skins=[],this.vertices=[]}function p(){this.model=new s}e.prototype=Object.create(null),e.prototype.mesh=-1,e.prototype.node=-1,n.prototype=Object.create(null),n.prototype.min=null,n.prototype.max=null,o.AABB=n,o.prototype=Object.create(null),o.prototype.aabb=null,o.prototype.base=-1,o.prototype.count=-1,o.prototype.type=null,o.prototype.vertices=-1,o.prototype.indices=null,r.prototype=Object.create(null),r.prototype.name=null,r.prototype.position=null,r.prototype.rotation=null,r.prototype.scale=null,a.prototype=Object.create(null),a.prototype.type=null,a.prototype.components=-1,a.prototype.data=null,i.VertexData=a,i.prototype=Object.create(null),i.prototype.position=null,i.prototype.texCoord0=null,i.prototype.normal=null,s.MeshInstance=e,s.Mesh=o,s.Node=r,s.Vertex=i,s.prototype=Object.create(null),s.prototype.version=-1,s.prototype.meshInstances=null,s.prototype.meshes=null,s.prototype.nodes=null,s.prototype.parents=null,s.prototype.skins=null,s.prototype.vertices=null,p.ModelData=s,p.prototype=Object.create(null),p.prototype.model=null,t.ModelFileFormat=p}(n.exports),function(t){function e(t,e){this._data=new DataView(t),this._position=0,this._size=t.byteLength,this._useLittleEndian=!e}e.SEEK_MODE={BEGIN:0,END:1,CURRENT:2},e.prototype=Object.create(null),e.prototype._data=null,e.prototype._position=0,e.prototype._size=0,e.prototype._useLittleEndian=!1,Object.defineProperty(e.prototype,"position",{get:function(){return this._position}}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size}}),e.prototype.destroy=function(){this._data=null,this._position=0,this._size=0},e.prototype.seek=function(t,n){var o=this._position,r=this._size;t===e.SEEK_MODE.BEGIN?this._position=Math.max(0,Math.min(r,n)):t===e.SEEK_MODE.END?this._position=Math.max(0,Math.min(r,r-n)):t===e.SEEK_MODE.CURRENT&&(this._position=Math.max(0,Math.min(r,o+n)))},e.prototype.readBytes=function(t){var e,n=this._data,o=this._position,r=(this._size,this._useLittleEndian),a=[];for(e=0;t>e;++e)a.push(n.getInt8(o+e,r));return this._position+=t,a},e.prototype.readByte=function(){var t,e=this._data,n=this._position,o=(this._size,this._useLittleEndian);return t=e.getInt8(n,o),this._position++,t},e.prototype.readInt32=function(){var t,e=this._data,n=this._position,o=(this._size,this._useLittleEndian);return t=e.getInt32(n,o),this._position+=4,t},e.prototype.readUint32=function(){var t,e=this._data,n=this._position,o=(this._size,this._useLittleEndian);return t=e.getUint32(n,o),this._position+=4,t},e.prototype.readSingle=function(){var t,e=this._data,n=this._position,o=(this._size,this._useLittleEndian);return t=e.getFloat32(n,o),this._position+=4,t},t.BinaryReader=e}(n.exports),function(t){function e(){}var n=t.using,o=t.stringFromBytes,r=t.BinaryReader,a=t.ModelFileFormat,i={NONE:0,SMALL_SIZE_OF_PACKED_DATA:1},s=new DataView(new ArrayBuffer(4));e.isHeaderValid=function(t){return n(new r(t),function(t){var e=t.readBytes(4);return e[0]==="L".charCodeAt(0)&&e[1]==="W".charCodeAt(0)&&e[2]==="M".charCodeAt(0)&&0===e[3]})},e.prototype=Object.create(null),e.prototype.unpack=function(t){return n(new r(t),function(t){var e,n,r,s,p,u,l,c,h,d,y,f,_,m,g,S,k,I,A,E,w,M,L,O,v,B,C,D,z,x,N=new a,T=N.model,F=0,b=0,V=0,Q=0,P=0;if(e=t.readBytes(4),e[0]!=="L".charCodeAt(0)||e[1]!=="W".charCodeAt(0)||e[2]!=="M".charCodeAt(0)||0!==e[3])throw new Error("Serializer::unpack | wrong header signature!");if(n=t.readByte(),r=0!==t.readByte(),T=N.model,T.version=t.readByte(),n===i.NONE?(F=t.readInt32(),b=t.readInt32(),V=t.readInt32(),Q=t.readInt32(),P=t.readInt32()):n===i.SMALL_SIZE_OF_PACKED_DATA&&(s=this.unpackIntsQuantized(t),F=s[0],b=s[1],V=s[2],Q=s[3],P=s[4]),F>0)if(n===i.NONE)for(v=0;F>v;++v)p=new a.ModelData.MeshInstance,p.mesh=t.readInt32(),p.node=t.readInt32(),T.meshInstances.push(p);else if(n===i.SMALL_SIZE_OF_PACKED_DATA){if(s=this.unpackIntsQuantized(t),s.length!==2*F)throw new Error("Serializer::unpack | mesh instances count does not match unpacked items count!");for(v=0,B=0;F>v;++v)p=new a.ModelData.MeshInstance,p.mesh=s[B++],p.node=s[B++],T.meshInstances.push(p)}if(b>0)if(n===i.NONE)for(v=0;b>v;++v){for(u=new a.ModelData.Mesh,d=t.readByte(),y=t.readBytes(d),u.type=o(y),u.base=t.readInt32(),u.count=t.readInt32(),u.vertices=t.readInt32(),f=new a.ModelData.Mesh.AABB,f.min.push(t.readSingle()),f.min.push(t.readSingle()),f.min.push(t.readSingle()),f.max.push(t.readSingle()),f.max.push(t.readSingle()),f.max.push(t.readSingle()),u.aabb=f,B=0;B<u.count;++B)u.indices.push(t.readUint32());T.meshes.push(u)}else if(n===i.SMALL_SIZE_OF_PACKED_DATA){if(_=this.unpackStringsQuantized(t),_.length!==b)throw new Error("Serializer::unpack | meshes count does not match unpacked items count!");if(m=this.unpackIntsQuantized(t),m.length!==3*b)throw new Error("Serializer::unpack | meshes count does not match unpacked items count!");for(v=0,B=0,C=0;b>v;++v){u=new a.ModelData.Mesh,u.type=_[B++],u.base=m[C++],u.count=m[C++],u.vertices=m[C++],f=new a.ModelData.Mesh.AABB,f.min.push(t.readSingle()),f.min.push(t.readSingle()),f.min.push(t.readSingle()),f.max.push(t.readSingle()),f.max.push(t.readSingle()),f.max.push(t.readSingle()),u.aabb=f;var U=this.unpackUintsQuantized(t);if(U.length!==u.count)throw new Error("Serializer::unpack | mesh "+v+" indices count does not match unpacked items count!");for(l=0;l<u.count;++l)u.indices.push(U[l]);T.meshes.push(u)}}if(V>0)if(n===i.NONE)for(v=0;V>v;++v)l=new a.ModelData.Node,c=t.readByte(),h=t.readBytes(c),l.name=o(h),l.position.push(t.readSingle()),l.position.push(t.readSingle()),l.position.push(t.readSingle()),l.rotation.push(t.readSingle()),l.rotation.push(t.readSingle()),l.rotation.push(t.readSingle()),l.scale.push(t.readSingle()),l.scale.push(t.readSingle()),l.scale.push(t.readSingle()),T.nodes.push(l);else if(n===i.SMALL_SIZE_OF_PACKED_DATA){if(s=this.unpackStringsQuantized(t),s.length!==V)throw new Error("Serializer::unpack | nodes count does not match unpacked items count!");for(v=0;V>v;++v)l=new a.ModelData.Node,l.name=s[v],l.position.push(t.readSingle()),l.position.push(t.readSingle()),l.position.push(t.readSingle()),l.rotation.push(t.readSingle()),l.rotation.push(t.readSingle()),l.rotation.push(t.readSingle()),l.scale.push(t.readSingle()),l.scale.push(t.readSingle()),l.scale.push(t.readSingle()),T.nodes.push(l)}if(Q>0)if(n===i.NONE)for(v=0;Q>v;++v)T.parents.push(t.readInt32());else if(n===i.SMALL_SIZE_OF_PACKED_DATA){if(s=this.unpackIntsQuantized(t),s.length!==Q)throw new Error("Serializer::unpack | parents count does not match unpacked items count!");for(v=0;Q>v;++v)T.parents.push(s[v])}if(P>0)if(n===i.NONE)for(v=0;P>v;++v){for(g=new a.ModelData.Vertex,S=new a.ModelData.Vertex.VertexData,d=t.readByte(),y=t.readBytes(d),S.type=o(y),S.components=t.readInt32(),k=t.readInt32(),B=0;k>B;++B)S.data.push(t.readSingle());for(g.position=S,S=new a.ModelData.Vertex.VertexData,d=t.readByte(),y=t.readBytes(d),S.type=o(y),S.components=t.readInt32(),k=t.readInt32(),B=0;k>B;++B)S.data.push(t.readSingle());for(g.texCoord0=S,S=new a.ModelData.Vertex.VertexData,d=t.readByte(),y=t.readBytes(d),S.type=o(y),S.components=t.readInt32(),k=t.readInt32(),B=0;k>B;++B)S.data.push(t.readSingle());g.normal=S,T.vertices.push(g)}else if(n===i.SMALL_SIZE_OF_PACKED_DATA){if(_=this.unpackStringsQuantized(t),_.length!==3*P)throw new Error("Serializer::unpack | vertices count does not match unpacked items count!");if(I=this.unpackIntsQuantized(t),I.length!==3*P)throw new Error("Serializer::unpack | vertices count does not match unpacked items count!");var K=this.unpackIntsQuantized(t);if(K.length!==3*P)throw new Error("Serializer::unpack | vertices count does not match unpacked items count!");for(v=0,D=0,z=0,x=0;P>v;++v){for(g=new a.ModelData.Vertex,A=g.position,E=g.texCoord0,w=g.normal,A.type=_[D++],E.type=_[D++],w.type=_[D++],A.components=I[z++],E.components=I[z++],w.components=I[z++],M=K[x++],L=K[x++],O=K[x++],B=0;M>B;++B)A.data.push(t.readSingle());for(B=0;L>B;++B)E.data.push(t.readSingle());for(B=0;O>B;++B)w.data.push(t.readSingle());r?(A.data=this.unpackFloatsLosslessQuantized(t),L>0&&(E.data=this.unpackFloatsLosslessQuantized(t)),O>0&&(w.data=this.unpackFloatsLosslessQuantized(t))):(A.data=this.unpackFloatsLossyQuantized(t),L>0&&(E.data=this.unpackFloatsLossyQuantized(t)),O>0&&(w.data=this.unpackFloatsLossyQuantized(t))),T.vertices.push(g)}}return N}.bind(this))},e.prototype.unpackUints=function(t){var n,o,a,i,s,p,u,l,c,h=t.readInt32(),d=t.readUint32(),y=t.readByte();if(0>=h)return null;if(n=new Array(h),0==y)for(c=0;h>c;++c)n[c]=d;else if(32>y){for(o=e.calculateBitsMask(y),a=0,i=0|t.readUint32(),s=0,p=0,u=0,l=0,c=0;h>c;++c)a=(i&o<<s)>>s&o,s+=y,s>=32&&(s-=32,p=y-s,u=e.calculateBitsMask(p),l=e.calculateBitsMask(s),i=t.readUint32()>>>0,a&=u,a|=(i&l)<<p),n[c]=((a&o)>>>0)+d;0==s&&t.seek(r.SEEK_MODE.CURRENT,-4)}else for(c=0;h>c;++c)n[c]=t.readUint32();return n},e.prototype.unpackInts=function(t){var n,o,a,i,s,p,u,l,c,h=t.readInt32(),d=t.readInt32(),y=t.readByte();if(0>=h)return null;if(n=new Array(h),0==y)for(c=0;h>c;++c)n[c]=d;else if(32>y){for(o=e.calculateBitsMask(y),a=0,i=0|t.readInt32(),s=0,p=0,u=0,l=0,c=0;h>c;++c)a=(i&o<<s)>>s&o,s+=y,s>=32&&(s-=32,p=y-s,u=e.calculateBitsMask(p),l=e.calculateBitsMask(s),i=t.readInt32()>>>0,a&=u,a|=(i&l)<<p),n[c]=((a&o)>>>0)+d;0==s&&t.seek(r.SEEK_MODE.CURRENT,-4)}else for(c=0;h>c;++c)n[c]=t.readInt32();return n},e.prototype.unpackFloatsLossless=function(t){var n,o,r=this.unpackInts(t),a=this.unpackInts(t),i=this.unpackInts(t),s=new Array(a.length),p=t._useLittleEndian;for(n=0,o=a.length;o>n;++n)s[n]=e.floatFromScientific(0!=r[n],a[n],i[n],p);return s},e.prototype.unpackFloatsLossy=function(t){var e,n,o=t.readByte(),r=this.unpackInts(t),a=new Array(r.length),i=Math.pow(10,-o);for(e=0,n=r.length;n>e;++e)a[e]=r[e]*i;return a},e.prototype.unpackStrings=function(t){var e,n,r,a,i=this.unpackInts(t),s=this.unpackInts(t),p=o(s),u=new Array(i.length);for(e=0,r=0,n=i.length;n>e;++e)a=i[e],u[e]=p.substring(r,r+a),r+=a;return u},e.prototype.unpackIntsQuantized=function(t){var e,n,o,r,a,i,s,p=t.readInt32();if(0>p)return this.unpackInts(t);for(e=t.readInt32(),n=new Array(e),r=0,s=0;p>r;++r)for(o=this.unpackInts(t),a=0,i=o.length;i>a;++a)n[s++]=o[a];return n},e.prototype.unpackUintsQuantized=function(t){var e,n,o,r,a,i,s,p=t.readInt32();if(0>p)return this.unpackUints(t);for(e=t.readInt32(),n=new Array(e),r=0,s=0;p>r;++r)for(o=this.unpackUints(t),a=0,i=o.length;i>a;++a)n[s++]=o[a];return n},e.prototype.unpackFloatsLosslessQuantized=function(t){var e,n,o,r,a,i,s,p=t.readInt32();if(0>p)return this.unpackFloatsLossless(t);for(e=t.readInt32(),n=new Array(e),r=0,s=0;p>r;++r)for(o=this.unpackFloatsLossless(t),a=0,i=o.length;i>a;++a)n[s++]=o[a];return n},e.prototype.unpackFloatsLossyQuantized=function(t){var e,n,o,r,a,i,s,p=t.readInt32();if(0>p)return this.unpackFloatsLossy(t);for(e=t.readInt32(),n=new Array(e),r=0,s=0;p>r;++r)for(o=this.unpackFloatsLossy(t),a=0,i=o.length;i>a;++a)n[s++]=o[a];return n},e.prototype.unpackStringsQuantized=function(t){var e,n,o,r,a,i,s,p=t.readInt32();if(0>p)return this.unpackStrings(t);for(e=t.readInt32(),n=new Array(e),r=0,s=0;p>r;++r)for(o=this.unpackStrings(t),a=0,i=o.length;i>a;++a)n[s++]=o[a];return n},e.calculateBitsMask=function(t){return(1<<t)-1},e.floatFromScientific=function(t,e,n,o){var r=8388607&n|(255&e)<<23|(t?1:0)<<31;return s.setInt32(0,r,o),s.getFloat32(0,o)},t.Serializer=e}(n.exports),function(t){function e(t){this._device=t}if(t.HOOK_INTO_PLAYCANVAS&&t.pc){var n=t.pc,o=t.stringFromBuffer,r=t.Serializer;e.DEFAULT_MATERIAL=n.ModelHandler.DEFAULT_MATERIAL.clone(),e.prototype=Object.create(null),e.prototype._device=null,e.prototype.load=function(t,e){n.net.http.get(t,function(t){e&&e(null,t)},{withCredentials:!1,responseType:"arraybuffer",error:function(o,r,a){e&&e(n.string.format("Error loading LWM model: {0} [status: {1}]",t,o))}})},e.prototype.open=function(t,e){var a,i,s;return r.isHeaderValid(e)?(i=new r,a=i.unpack(e)):(s=o(e),a=JSON.parse(s)),this.ensureVertices(a),n.ModelHandler.prototype.open.call(this,t,a)},e.prototype.patch=function(t,e){n.ModelHandler.prototype.patch.call(this,t,e)},e.prototype.ensureVertices=function(t){var e,o,r,a,i,s,p,u,l=t.model,c=l?l.vertices:null;if(c)for(e=0,r=c.length;r>e;++e)if(a=c[e],i=a.position,s=a.texCoord0,p=a.normal,i&&s&&p){for(o=s.data.length,u=(n.data.length/n.components|0)*s.components;u>o;++o)s.data.push(0);for(o=p.data.length,u=(n.data.length/n.components|0)*p.components;u>o;++o)s.data.push(0)}},t.LWMModelHandler=e}}(n.exports),function(t){function e(t){this._pc=t}var n=t.LWMModelHandler;e.prototype=Object.create(null),e.prototype._pc=null,e.prototype._pc_http_isBinaryContentType=null,e.prototype.hook=function(){var t,e,o,r,a=this._pc,i=a?a.net:null,s=i?i.Http:null,p=i?i.http:null,u=a?a.Application:null;if(s&&(s.ContentType&&!s.ContentType.hasOwnProperty("LWM")&&(s.ContentType.LWM="application/octet-stream"),s.binaryExtensions&&s.binaryExtensions.indexOf(".lwm")<0&&s.binaryExtensions.push(".lwm"),this._pc_http_isBinaryContentType||(this._pc_http_isBinaryContentType=s.prototype.isBinaryContentType,s.prototype.isBinaryContentType=function(t){var e=[s.ContentType.WAV,s.ContentType.OGG,s.ContentType.MP3,s.ContentType.BIN,s.ContentType.DDS,s.ContentType.LWM];return e.indexOf(t)>=0}),p&&(p.isBinaryContentType=s.prototype.isBinaryContentType)),u&&u._applications){t=u._applications;for(r in t)t.hasOwnProperty(r)&&(e=t[r],e&&(o=e.loader,o&&o.addHandler("lwmmodel",new n(e.graphicsDevice))))}},t.PlayCanvasHook=e}(n.exports),e.HOOK_INTO_PLAYCANVAS&&t.pc&&new e.PlayCanvasHook(t.pc).hook()}(window);