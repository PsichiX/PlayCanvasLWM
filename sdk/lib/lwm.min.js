!function(t){"use strict";var e=t.lwm={pc:t.pc},n={exports:e};e.HOOK_INTO_PLAYCANVAS=t.hasOwnProperty("LWM_HOOK_INTO_PLAYCANVAS")?t.LWM_HOOK_INTO_PLAYCANVAS:!0,function(t){t.using=function(t,e){var n;try{n=e(t)}finally{t.destroy()}return n},t.stringFromBytes=function(t){return String.fromCharCode.apply(null,t)},t.stringFromBuffer=function(t){var e,n,o,r=new Uint16Array(t),i="";for(e=0,n=r.length;n>e;e+=65535)o=65535,e+65535>n&&(o=n-e),i+=String.fromCharCode.apply(null,r.subarray(e,e+o));return i}}(n.exports),function(t){function e(){this.mesh=-1,this.node=-1}function n(){this.min=[],this.max=[]}function o(){this.aabb=new n,this.base=-1,this.count=-1,this.type="",this.vertices=-1,this.indices=[]}function r(){this.name="",this.position=[],this.rotation=[],this.scale=[]}function i(){this.type="",this.components=-1,this.data=[]}function a(){this.position=new i,this.texCoord0=new i,this.normal=new i}function s(){this.version=-1,this.meshInstances=[],this.meshes=[],this.nodes=[],this.parents=[],this.skins=[],this.vertices=[]}function p(){this.model=new s}e.prototype=Object.create(null),e.prototype.mesh=-1,e.prototype.node=-1,n.prototype=Object.create(null),n.prototype.min=null,n.prototype.max=null,o.AABB=n,o.prototype=Object.create(null),o.prototype.aabb=null,o.prototype.base=-1,o.prototype.count=-1,o.prototype.type=null,o.prototype.vertices=-1,o.prototype.indices=null,r.prototype=Object.create(null),r.prototype.name=null,r.prototype.position=null,r.prototype.rotation=null,r.prototype.scale=null,i.prototype=Object.create(null),i.prototype.type=null,i.prototype.components=-1,i.prototype.data=null,a.VertexData=i,a.prototype=Object.create(null),a.prototype.position=null,a.prototype.texCoord0=null,a.prototype.normal=null,s.MeshInstance=e,s.Mesh=o,s.Node=r,s.Vertex=a,s.prototype=Object.create(null),s.prototype.version=-1,s.prototype.meshInstances=null,s.prototype.meshes=null,s.prototype.nodes=null,s.prototype.parents=null,s.prototype.skins=null,s.prototype.vertices=null,p.ModelData=s,p.prototype=Object.create(null),p.prototype.model=null,t.ModelFileFormat=p}(n.exports),function(t){function e(t,e){this._data=new DataView(t),this._position=0,this._size=t.byteLength,this._useLittleEndian=!e}e.SEEK_MODE={BEGIN:0,END:1,CURRENT:2},e.prototype=Object.create(null),e.prototype._data=null,e.prototype._position=0,e.prototype._size=0,e.prototype._useLittleEndian=!1,Object.defineProperty(e.prototype,"position",{get:function(){return this._position}}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size}}),e.prototype.destroy=function(){this._data=null,this._position=0,this._size=0},e.prototype.seek=function(t,n){var o=this._position,r=this._size;t===e.SEEK_MODE.BEGIN?this._position=Math.max(0,Math.min(r,n)):t===e.SEEK_MODE.END?this._position=Math.max(0,Math.min(r,r-n)):t===e.SEEK_MODE.CURRENT&&(this._position=Math.max(0,Math.min(r,o+n)))},e.prototype.readBytes=function(t){var e,n=this._data,o=this._position,r=(this._size,this._useLittleEndian),i=[];for(e=0;t>e;++e)i.push(n.getInt8(o+e,r));return this._position+=t,i},e.prototype.readByte=function(){var t,e=this._data,n=this._position,o=(this._size,this._useLittleEndian);return t=e.getInt8(n,o),this._position++,t},e.prototype.readInt32=function(){var t,e=this._data,n=this._position,o=(this._size,this._useLittleEndian);return t=e.getInt32(n,o),this._position+=4,t},e.prototype.readUint32=function(){var t,e=this._data,n=this._position,o=(this._size,this._useLittleEndian);return t=e.getUint32(n,o),this._position+=4,t},e.prototype.readSingle=function(){var t,e=this._data,n=this._position,o=(this._size,this._useLittleEndian);return t=e.getFloat32(n,o),this._position+=4,t},t.BinaryReader=e}(n.exports),function(t){function e(){}var n=t.using,o=t.stringFromBytes,r=t.BinaryReader,i=t.ModelFileFormat,a={NONE:0,SMALL_SIZE_OF_PACKED_DATA:1};e.isHeaderValid=function(t){return n(new r(t),function(t){var e=t.readBytes(4);return e[0]==="L".charCodeAt(0)&&e[1]==="W".charCodeAt(0)&&e[2]==="M".charCodeAt(0)&&0===e[3]})},e.prototype=Object.create(null),e.prototype.unpack=function(t){return n(new r(t),function(t){var e,n,r,s,p,u,l,c,h,d,y,f,_,m,g,S,E,A,I,M,w,k,O,C,B,v,D,L,x,N=new i,T=N.model,z=0,b=0,V=0,P=0,U=0;if(e=t.readBytes(4),e[0]!=="L".charCodeAt(0)||e[1]!=="W".charCodeAt(0)||e[2]!=="M".charCodeAt(0)||0!==e[3])throw new Error("Serializer::unpack | wrong header signature!");if(n=t.readByte(),T=N.model,T.version=t.readByte(),n===a.NONE?(z=t.readInt32(),b=t.readInt32(),V=t.readInt32(),P=t.readInt32(),U=t.readInt32()):n===a.SMALL_SIZE_OF_PACKED_DATA&&(r=this.unpackIntsQuantized(t),z=r[0],b=r[1],V=r[2],P=r[3],U=r[4]),z>0)if(n===a.NONE)for(C=0;z>C;++C)s=new i.ModelData.MeshInstance,s.mesh=t.readInt32(),s.node=t.readInt32(),T.meshInstances.push(s);else if(n===a.SMALL_SIZE_OF_PACKED_DATA){if(r=this.unpackIntsQuantized(t),r.length!==2*z)throw new Error("Serializer::unpack | mesh instances count does not match unpacked items count!");for(C=0,B=0;z>C;++C)s=new i.ModelData.MeshInstance,s.mesh=r[B++],s.node=r[B++],T.meshInstances.push(s)}if(b>0)if(n===a.NONE)for(C=0;b>C;++C){for(p=new i.ModelData.Mesh,h=t.readByte(),d=t.readBytes(h),p.type=o(d),p.base=t.readInt32(),p.count=t.readInt32(),p.vertices=t.readInt32(),y=new i.ModelData.Mesh.AABB,y.min.push(t.readSingle()),y.min.push(t.readSingle()),y.min.push(t.readSingle()),y.max.push(t.readSingle()),y.max.push(t.readSingle()),y.max.push(t.readSingle()),p.aabb=y,B=0;B<p.count;++B)p.indices.push(t.readUint32());T.meshes.push(p)}else if(n===a.SMALL_SIZE_OF_PACKED_DATA){if(f=this.unpackStringsQuantized(t),f.length!==b)throw new Error("Serializer::unpack | meshes count does not match unpacked items count!");if(_=this.unpackIntsQuantized(t),_.length!==3*b)throw new Error("Serializer::unpack | meshes count does not match unpacked items count!");for(C=0,B=0,v=0;b>C;++C){p=new i.ModelData.Mesh,p.type=f[B++],p.base=_[v++],p.count=_[v++],p.vertices=_[v++],y=new i.ModelData.Mesh.AABB,y.min.push(t.readSingle()),y.min.push(t.readSingle()),y.min.push(t.readSingle()),y.max.push(t.readSingle()),y.max.push(t.readSingle()),y.max.push(t.readSingle()),p.aabb=y;var F=this.unpackUintsQuantized(t);if(F.length!==p.count)throw new Error("Serializer::unpack | mesh "+C+" indices count does not match unpacked items count!");for(u=0;u<p.count;++u)p.indices.push(F[u]);T.meshes.push(p)}}if(V>0)if(n===a.NONE)for(C=0;V>C;++C)u=new i.ModelData.Node,l=t.readByte(),c=t.readBytes(l),u.name=o(c),u.position.push(t.readSingle()),u.position.push(t.readSingle()),u.position.push(t.readSingle()),u.rotation.push(t.readSingle()),u.rotation.push(t.readSingle()),u.rotation.push(t.readSingle()),u.scale.push(t.readSingle()),u.scale.push(t.readSingle()),u.scale.push(t.readSingle()),T.nodes.push(u);else if(n===a.SMALL_SIZE_OF_PACKED_DATA){if(r=this.unpackStringsQuantized(t),r.length!==V)throw new Error("Serializer::unpack | nodes count does not match unpacked items count!");for(C=0;V>C;++C)u=new i.ModelData.Node,u.name=r[C],u.position.push(t.readSingle()),u.position.push(t.readSingle()),u.position.push(t.readSingle()),u.rotation.push(t.readSingle()),u.rotation.push(t.readSingle()),u.rotation.push(t.readSingle()),u.scale.push(t.readSingle()),u.scale.push(t.readSingle()),u.scale.push(t.readSingle()),T.nodes.push(u)}if(P>0)if(n===a.NONE)for(C=0;P>C;++C)T.parents.push(t.readInt32());else if(n===a.SMALL_SIZE_OF_PACKED_DATA){if(r=this.unpackIntsQuantized(t),r.length!==P)throw new Error("Serializer::unpack | parents count does not match unpacked items count!");for(C=0;P>C;++C)T.parents.push(r[C])}if(U>0)if(n===a.NONE)for(C=0;U>C;++C){for(m=new i.ModelData.Vertex,g=new i.ModelData.Vertex.VertexData,h=t.readByte(),d=t.readBytes(h),g.type=o(d),g.components=t.readInt32(),S=t.readInt32(),B=0;S>B;++B)g.data.push(t.readSingle());for(m.position=g,g=new i.ModelData.Vertex.VertexData,h=t.readByte(),d=t.readBytes(h),g.type=o(d),g.components=t.readInt32(),S=t.readInt32(),B=0;S>B;++B)g.data.push(t.readSingle());for(m.texCoord0=g,g=new i.ModelData.Vertex.VertexData,h=t.readByte(),d=t.readBytes(h),g.type=o(d),g.components=t.readInt32(),S=t.readInt32(),B=0;S>B;++B)g.data.push(t.readSingle());m.normal=g,T.vertices.push(m)}else if(n===a.SMALL_SIZE_OF_PACKED_DATA){if(f=this.unpackStringsQuantized(t),f.length!==3*U)throw new Error("Serializer::unpack | vertices count does not match unpacked items count!");if(E=this.unpackIntsQuantized(t),E.length!==3*U)throw new Error("Serializer::unpack | vertices count does not match unpacked items count!");var K=this.unpackIntsQuantized(t);if(K.length!==3*U)throw new Error("Serializer::unpack | vertices count does not match unpacked items count!");for(C=0,D=0,L=0,x=0;U>C;++C){for(m=new i.ModelData.Vertex,A=m.position,I=m.texCoord0,M=m.normal,A.type=f[D++],I.type=f[D++],M.type=f[D++],A.components=E[L++],I.components=E[L++],M.components=E[L++],w=K[x++],k=K[x++],O=K[x++],B=0;w>B;++B)A.data.push(t.readSingle());for(B=0;k>B;++B)I.data.push(t.readSingle());for(B=0;O>B;++B)M.data.push(t.readSingle());T.vertices.push(m)}}return N}.bind(this))},e.prototype.unpackUints=function(t){var e,n,o,i,a,s,p,u,l,c=t.readInt32(),h=t.readUint32(),d=t.readByte();if(0>=c)return null;if(e=new Array(c),0==d)for(l=0;c>l;++l)e[l]=h;else if(32>d){for(n=this.calculateBitsMask(d),o=0,i=0|t.readUint32(),a=0,s=0,p=0,u=0,l=0;c>l;++l)o=(i&n<<a)>>a&n,a+=d,a>=32&&(a-=32,s=d-a,p=this.calculateBitsMask(s),u=this.calculateBitsMask(a),i=t.readUint32()>>>0,o&=p,o|=(i&u)<<s),e[l]=((o&n)>>>0)+h;0==a&&t.seek(r.SEEK_MODE.CURRENT,-4)}else for(l=0;c>l;++l)e[l]=t.readUint32();return e},e.prototype.unpackInts=function(t){var e,n,o,i,a,s,p,u,l,c=t.readInt32(),h=t.readInt32(),d=t.readByte();if(0>=c)return null;if(e=new Array(c),0==d)for(l=0;c>l;++l)e[l]=h;else if(32>d){for(n=this.calculateBitsMask(d),o=0,i=0|t.readInt32(),a=0,s=0,p=0,u=0,l=0;c>l;++l)o=(i&n<<a)>>a&n,a+=d,a>=32&&(a-=32,s=d-a,p=this.calculateBitsMask(s),u=this.calculateBitsMask(a),i=t.readInt32()>>>0,o&=p,o|=(i&u)<<s),e[l]=((o&n)>>>0)+h;0==a&&t.seek(r.SEEK_MODE.CURRENT,-4)}else for(l=0;c>l;++l)e[l]=t.readInt32();return e},e.prototype.unpackStrings=function(t){var e,n,r,i,a=this.unpackInts(t),s=this.unpackInts(t),p=o(s),u=new Array(a.length);for(e=0,r=0,n=a.length;n>e;++e)i=a[e],u[e]=p.substring(r,r+i),r+=i;return u},e.prototype.unpackIntsQuantized=function(t){var e,n,o,r,i,a,s,p=t.readInt32();if(0>p)return this.unpackInts(t);for(e=t.readInt32(),n=new Array(e),r=0,s=0;p>r;++r)for(o=this.unpackInts(t),i=0,a=o.length;a>i;++i)n[s++]=o[i];return n},e.prototype.unpackUintsQuantized=function(t){var e,n,o,r,i,a,s,p=t.readInt32();if(0>p)return this.unpackUints(t);for(e=t.readInt32(),n=new Array(e),r=0,s=0;p>r;++r)for(o=this.unpackUints(t),i=0,a=o.length;a>i;++i)n[s++]=o[i];return n},e.prototype.unpackStringsQuantized=function(t){var e,n,o,r,i,a,s,p=t.readInt32();if(0>p)return this.unpackStrings(t);for(e=t.readInt32(),n=new Array(e),r=0,s=0;p>r;++r)for(o=this.unpackStrings(t),i=0,a=o.length;a>i;++i)n[s++]=o[i];return n},e.prototype.calculateBitsMask=function(t){return(1<<t)-1},t.Serializer=e}(n.exports),function(t){function e(t){this._device=t}if(t.HOOK_INTO_PLAYCANVAS&&t.pc){var n=t.pc,o=t.stringFromBuffer,r=t.Serializer;e.DEFAULT_MATERIAL=n.ModelHandler.DEFAULT_MATERIAL.clone(),e.prototype=Object.create(null),e.prototype._device=null,e.prototype.load=function(t,e){n.net.http.get(t,function(t){e&&e(null,t)},{withCredentials:!1,responseType:"arraybuffer",error:function(o,r,i){e&&e(n.string.format("Error loading LWM model: {0} [status: {1}]",t,o))}})},e.prototype.open=function(t,e){var i,a,s;return r.isHeaderValid(e)?(a=new r,i=a.unpack(e)):(s=o(e),i=JSON.parse(s)),this.ensureVertices(i),n.ModelHandler.prototype.open.call(this,t,i)},e.prototype.patch=function(t,e){n.ModelHandler.prototype.patch.call(this,t,e)},e.prototype.ensureVertices=function(t){var e,o,r,i,a,s,p,u,l=t.model,c=l?l.vertices:null;if(c)for(e=0,r=c.length;r>e;++e)if(i=c[e],a=i.position,s=i.texCoord0,p=i.normal,a&&s&&p){for(o=s.data.length,u=(n.data.length/n.components|0)*s.components;u>o;++o)s.data.push(0);for(o=p.data.length,u=(n.data.length/n.components|0)*p.components;u>o;++o)s.data.push(0)}},t.LWMModelHandler=e}}(n.exports),function(t){function e(t){this._pc=t}var n=t.LWMModelHandler;e.prototype=Object.create(null),e.prototype._pc=null,e.prototype._pc_http_isBinaryContentType=null,e.prototype.hook=function(){var t,e,o,r,i=this._pc,a=i?i.net:null,s=a?a.Http:null,p=a?a.http:null,u=i?i.Application:null;if(s&&(s.ContentType&&!s.ContentType.hasOwnProperty("LWM")&&(s.ContentType.LWM="application/octet-stream"),s.binaryExtensions&&s.binaryExtensions.indexOf(".lwm")<0&&s.binaryExtensions.push(".lwm"),this._pc_http_isBinaryContentType||(this._pc_http_isBinaryContentType=s.prototype.isBinaryContentType,s.prototype.isBinaryContentType=function(t){var e=[s.ContentType.WAV,s.ContentType.OGG,s.ContentType.MP3,s.ContentType.BIN,s.ContentType.DDS,s.ContentType.LWM];return e.indexOf(t)>=0}),p&&(p.isBinaryContentType=s.prototype.isBinaryContentType)),u&&u._applications){t=u._applications;for(r in t)t.hasOwnProperty(r)&&(e=t[r],e&&(o=e.loader,o&&o.addHandler("lwmmodel",new n(e.graphicsDevice))))}},t.PlayCanvasHook=e}(n.exports),e.HOOK_INTO_PLAYCANVAS&&t.pc&&new e.PlayCanvasHook(t.pc).hook()}(window);